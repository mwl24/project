---
title: "Final Report"
author: "Michael Li"
date: "March 1, 2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

```{r, echo = F, warning = F, message = F}
library(readxl)
library(ggplot2)
library(plyr)
library(tidyverse)
library(sjlabelled)
library(splus2R)
library(WCE)
library(survival)
library(eha)
library(survminer)
library(MASS)
library(sure)
library(simpleboot)
library(AER)
library(PResiduals)
library(kableExtra)
library(broom)
```

# Introduction

At the tail end of former President Trump’s term, the rise of social unrest within the United States became an undeniable reality of American life. The Black Lives Matter movement and the recent violent insurrection of pro-Trump supporters at the Capitol are just two of the campaigns by U.S. civilians of dissatisfaction with U.S. institutions and state actors. The events associated with these protests garnered international attention`--` mostly solidarity for the BLM movement and condemnation for the Capitol Hill riot`––` but the ugly truths surrounding social movements in other countries, especially autocratic nations where governmental abuses are most egregious, often fly under the radar [1]. Given this, we are interested in investigating social unrest globally and developing a better understanding of the power that grassroots movements hold in challenging governments. It is imperative to recognize that civil resistance is also far from monolithic; oftentimes, the seeds of the most visible campaigns are sown in the form of smaller movements. For example, while media and academia have recognized the political potency of the 18-day occupation of Tahrir Square in 2011 that led to the removal of Egyptian President Hosni Mubarak, there has been scant attention given [2]. Existing studies showing the success of tactical movements at acheiving political aims are limited to single-country analyses and only examine first-world countries [3]. Given that there is a gap in the literature surrounding autocratic regimes and the factors that influence success in these contexts, we will seek to provide a more comprehensive picture of global protests. The primary goals for this study are as follows:
  \begin{itemize}
   \item What are the most important determinants of a successful protest?
   \item What protest tactics are effective when considering the cumulative effects of protests within their larger campaigns or movements?
   \item Does the use of violence by a government lead to a 'chilling effect', whereby future protests are deterred?
   \end{itemize} 
   
# Data

This paper uses the NAVCO 3.0 dataset assembled as part of the Nonviolent and Violent Campaigns and Outcomes (NAVCO) data project, the first and only project to collect systematic, global data on both violent insurgencies and nonviolent civil resistance campaigns [3]. This was done by manually coding variables of interest for events according to news reports. Coders used news wire reports from Agence France Presse (AFP), the world's oldest and a leading international news agency, to access relevant articles. After binning the articles according to country and time period of interest, coders followed a rigorous set of instructions specified by Chenoweth, Pinckney, and Lewis to identify relevant events and appropriately translate text in articles to values usable for data analysis. The dataset contains data from 22 countries across the world, in both developed and developing countries. For the research question concerning campaigns, the NAVCO 1.3 and 2.0 datasets that contain information on the campaign level will be used to sort individual protests into the larger movements in which they operate.

For the first research question concerning general protest success, this paper will utilize governmental response as the outcome, an ordinal variable with seven levels to indicate the type of response that the government used when responding to a protest. Lower levels correspond to more conciliatory responses, while higher levels correspond to the greater use of violence. The second research question will use a newly created concessions predictor, a binary variable that indicates whether or not the government made any form of concessions to a protest. This was done by recoding the governmental response variable such that the lower three levels, which designate that the government made some form of accomodation to protesters, were recorded as a one, with all other levels of the governmental response variable recorded as zero. The final research question uses protest frequency as the response, which is operationalized as the number of protests within a certain country occurring within a year either before or after a repressive event, as fears over governmental backlash may last many months at a time. We also created a timing variable, which serves as an indicator denoting whether these observed frequencies occurred before or after the event. The predictor variables fall into seven main categories: location, date, perpetrator characteristics, perpetrator goals, perpetrator methods, target characteristics, and economic impact. For all three models, we will focus heavily on the subset of predictors related to the methods that perpetrators utilize, although the covariates used for each research question will vary given implementation constraints that will be explained later, such as the inability to use categorical data in our cumulative effects model. Existing literature suggests that factors such as the type of protester, with government-affiliated actors being most successful in instituting political change, and the ambitions of the protesters heavily influence protest success [4]. Another source suggests that non-violent protests are generally most effective because they allow younger demographics that are not equipped to engage in violence to participate, expanding the size of the protest, although this effect varies in the countries they analyzed [5]. Thus, all of our models across the three questions contain information about the tactics used and geographic scope of protests.

```{r, echo = F, warning = F, message = F}
df <- read_excel("data/navco3-0full.xlsx")
```

```{r, echo = F, warning = F, message = F}
# clean dataset 
# remove irrelevant variables
df_clean <- df %>% 
  dplyr::select(-c(coder, event_desc, cowcode, source_title, arbitration, notes, decision))
```

```{r, echo = F, warning = F, message = F}
# separate out date into 3 columns
df_clean$date <- as.Date(df_clean$date)
df_clean <- df_clean %>% 
  dplyr::mutate(year = as.double(format(date, format = "%Y")),
                 month = as.double(format(date, format = "%m")),
                 day = as.double(format(date, format = "%d")))
```

```{r, echo = F, warning = F, message = F}
# turn variables incorrectly cast as doubles into factors 
df_clean$geo_scope <- ordered(df_clean$geo_scope, levels = c(0, 1, 2, 3, 4), 
                              labels = c("local", "regional", "national", 
                                         "international regional", "global"))

df_clean$actor_id <- as.factor(df_clean$actor_id)
levels(df_clean$actor_id) <- c("state", "non-state", "international", "nonaligned", "local state")

df_clean$verb_10 <- ordered(df_clean$verb_10, levels = 1:21, 
                              labels = c("pub state", "appeal", "exp coop",
                                         "consult", "pol coop", "mat coop",
                                         "prov aid", "yield", "investigate",
                                         "demand", "disapprove", "reject",
                                         "threaten", "protest", "force post", 
                                         "reduce rel", "coerce", "repress", 
                                         "vio combat", "unc mass vio", "defect"
                                         ))

## verb_100 and verb_1000 need to be altered

df_clean$camp_goals <- as.factor(df_clean$camp_goals)
levels(df_clean$camp_goals) <- c("Regime Change", "Institutional Reform", "Policy Change", 
                                 "Territorial Secession", "Autonomy", "Anti-occupation", "Unknown")

df_clean$tactical_choice <- as.factor(df_clean$tactical_choice)
levels(df_clean$tactical_choice) <- c("violent", "nonviolent", "mixed")

df_clean$nv_categ <- as.factor(df_clean$nv_categ)
levels(df_clean$nv_categ) <- c("persuasion", "protest", "noncooperation",
                               "intervention", "pol engage")

# set 0s as NAs bc it is unclear what they correspond to from the data dictionary (only 32)
df_clean$nc_type[df_clean$nc_type == 0] <- NA
df_clean$nc_type <- as.factor(df_clean$nc_type)
levels(df_clean$nc_type) <- c("social noncoop", "econ noncoop boy", 
                              "econ noncoop strk", "pol noncoop")

# set 0s as NAs bc it is unclear what they correspond to from the data dictionary (only 3)
df_clean$nv_commission[df_clean$nv_commission == 3] <- NA
df_clean$nv_commission <- as.factor(df_clean$nv_commission)
levels(df_clean$nv_commission) <- c("omission", "commission", "ambiguous")

# set 3s as NAs bc it is unclear what they correspond to from the data dictionary (only 2)
df_clean$nv_concentration[df_clean$nv_concentration == 3] <- NA
df_clean$nv_concentration <- as.factor(df_clean$nv_concentration)
levels(df_clean$nv_concentration) <- c("phys dispersion", "phys concentration",
                                       "mixed")

df_clean$st_posture <- ordered(df_clean$st_posture, levels = 1:7, 
                              labels = c("Full Accomodations", "Material Concessions",
                                         "Nonmaterial Concessions", "Neutral",
                                         "Nonmaterial Repression", "Material Repression",
                                         "Intended Killings"))

# assumed that non-defined level of 1 corresponds to moderate damange
df_clean$damage <- ordered(df_clean$damage, levels = 0:3, 
                              labels = c("minor", "moderate",
                                         "significant", "substantial"))

# recode 0s as 1s since 1 corresponds to "little or no impact" already
df_clean$econ_impact <- ordered(df_clean$econ_impact, levels = 0:3, 
                              labels = c("none","little", "significant",
                                         "heavy"))
```

```{r, echo = F, warning = F, message = F}
# turn variables incorrectly cast as characters into doubles
# for ranges, take the average
df_clean <- df_clean %>% 
  separate(fatal_casu, into = c("fatal_low", "fatal_high"), sep = "-") %>%  # R will remove spaces when coercing
  separate(injuries, into = c("inj_low", "inj_high"), sep = "-") %>% 
  separate(num_partic_event, into = c("partic_low", "partic_high"), sep = "-") %>% 
  dplyr::mutate(fatal_casu = case_when(is.na(fatal_high) ~ as.double(fatal_low),
                                TRUE ~ (as.double(fatal_low) + as.double(fatal_high)) / 2),
         injuries = case_when(is.na(inj_high) ~ as.double(inj_low),
                                TRUE ~ (as.double(inj_low) + as.double(inj_high)) / 2),
         num_partic_event = case_when(is.na(partic_high) ~ as.double(partic_low),
                                TRUE ~ (as.double(partic_low) + as.double(partic_high)) / 2)
         ) %>% 
  dplyr::select(-c(fatal_low, fatal_high, inj_low, inj_high, partic_low, partic_high))
```

```{r, echo = F, warning = F, message = F}
# reclean data to categorize NA values in continuous variables as zero (assume no or negligble values for NAs)
df_clean[is.na(df_clean$damage), c("damage")] <- "minor"
df_clean[is.na(df_clean$econ_impact), c("econ_impact")] <- "none"
df_clean[is.na(df_clean$fatal_casu), c("fatal_casu")] <- 0
df_clean[is.na(df_clean$injuries), c("injuries")] <- 0
#df_clean[is.na(df_clean$num_partic_event), c("num_partic_event")] <- 0

# df_clean %>% 
#   filter(!is.na(nv_categ), !is.na(nc_type), !is.na(nv_commission), 
#          !is.na(nv_concentration))

## reorder variables actor_id, verb_10?, camp_goals, tactical_choice, st_posture
df_clean$actor_id <- factor(df_clean$actor_id, ordered = FALSE)
df_clean$camp_goals <- factor(df_clean$camp_goals, ordered = FALSE)
df_clean$actor_id <- factor(df_clean$actor_id, ordered = FALSE)
df_clean <- df_clean %>% 
  dplyr::mutate(tactical_choice = factor(case_when(as.integer(tactical_choice) == 1 ~ 3.0, # violent (1) --> 3
                             as.integer(tactical_choice) == 2 ~ 1.0, # non-violent (2) --> 1
                             TRUE ~ 2.0), order = TRUE, levels = c(1, 2, 3))) # mixed(3) --> 2
```

<!-- Protest Success Data Cleaning -->

```{r, echo = F, warning = F, message = F}
# collapse levels of categorical variables
df_ord <- df_clean
levels(df_ord$actor_id) <- list(state = c("state", "local state"), 
                              international = c("international"),
                              `non-state` = c("non-state", "nonaligned"))
levels(df_ord$camp_goals) <- list(`Regime Change` = c("Regime Change"), 
                              `Institutional Reform` = c("Institutional Reform"),
                              `Policy Change` = c("Policy Change"),
                              `Territorial Secession` = c("Territorial Secession"),
                              `Autonomy` = c("Autonomy", "Anti-occupation"),
                              `Unknown` = c("Unknown"),
                              `Missing` = c("Missing"))

df_ord <- df_ord %>% 
  dplyr::mutate(region = case_when(country_name %in% c("algeria", "egypt",
                                                   "kenya", "libya", 
                                                   "madagascar", "morocco",
                                                "sierra_leone", "south_sudan",
                                                "sudan", "tanzania", "tunisia") ~ "Africa",
                               country_name %in% c("iraq", "jordan", "syria",
                                                   "turkey", "yemen") ~ "Middle East",
                               country_name %in% c("bahrain", "china", 
                                                   "india", "pakistan",
                                                   "south_korea", "uzbekistan") ~ "Asia",
                               country_name %in% c("estonia", "ukraine") ~ "Europe",
                               TRUE ~ "Americas")) # Mexico, U.S.
```

<!-- Cumulative Protests Data Cleaning -->

```{r, echo = F, warning = F, message = F}
df_pwp <- df_clean %>% 
  group_by(country_name, year) %>% 
  filter(target_3 %in% c("COP", "GOV", "JUD", "MIL", "LLY", "SPY", "LEG", "TOP")) %>% 
  ungroup()

df_pwp <- df_pwp %>% filter(!is.na(tactical_choice) & !is.na(st_posture))
  
df_pwp$id <- df_pwp %>% group_by(country_name, year) %>% 
  group_indices() 

df_pwp <- df_pwp %>%
  ungroup() %>% 
  arrange(id, date) %>% 
  group_by(id) %>% 
  dplyr::mutate(diff_time = as.double(date - lag(date))) # get time difference b/w protests

df_pwp$diff_time[is.na(df_pwp$diff_time)] <- 0
df_temp <- df_pwp %>% group_by(id) %>% 
  dplyr::mutate(Stop = cumsum(diff_time) + 1)
df_pwp$Stop <- df_temp$Stop

# classify governmental responses into binary variable for concessions Y/N
df_pwp <- df_pwp %>% 
  dplyr::mutate(concessions = if_else(st_posture == "Full Accomodations" | 
                         st_posture == "Material Concessions" | 
                         st_posture == "Nonmaterial Concessions", 1, 0 ))

# consolidate same-day protests
df_pwp <- df_pwp %>% 
  group_by(id, date) %>% 
  dplyr::mutate(num_protests_day = n()) %>% 
  ungroup()

df_pwp <- df_pwp %>% 
  group_by(id, date) %>% 
  slice(which.min(st_posture)) %>% 
  ungroup()
```

```{r, echo = F, warning = F, message = F}
# filter to get final concession made in response to a campaign
df_wce_conc <- df_pwp %>%
  filter(concessions == 1) %>%
  group_by(id) %>%
  slice(n()) %>%
  ungroup()

df_wce <- rbind(df_pwp %>%
                       filter(concessions == 0), df_wce_conc) %>%
  arrange(id, date) %>%
  group_by(id) %>%
  dplyr::mutate(last_concession = min(which(concessions == 1 | row_number() ==n()))) %>%
  filter(row_number() <= last_concession) %>%
  dplyr::select(-last_concession)

# match start dates to match events with complete information
df_wce <- df_wce %>% 
  group_by(id) %>% 
  dplyr::mutate(Start = lag(Stop)) %>% 
  ungroup()
df_wce$Start[is.na(df_wce$Start)] <- 0

# convert id to a double
df_wce$id <- as.double(df_wce$id)

# get number of protests
df_wce <- df_wce %>% 
  group_by(id) %>% 
  #filter(concessions == 1) %>% 
  dplyr::mutate(enum = row_number()) %>% 
  dplyr::mutate(enum = if_else(enum >= 8, 8, as.double(enum))) %>% 
  ungroup()


# continent variable
df_wce <- df_wce %>% 
  dplyr::mutate(region = case_when(country_name %in% c("algeria", "egypt",
                                                   "kenya", "libya", 
                                                   "madagascar", "morocco",
                                                "sierra_leone", "south_sudan",
                                                "sudan", "tanzania", "tunisia") ~ "Africa",
                               country_name %in% c("iraq", "jordan", "syria",
                                                   "turkey", "yemen") ~ "Middle East",
                               country_name %in% c("bahrain", "china", 
                                                   "india", "pakistan",
                                                   "south_korea", "uzbekistan") ~ "Asia",
                               country_name %in% c("estonia", "ukraine") ~ "Europe",
                               TRUE ~ "Americas")) # Mexico, U.S.
```

```{r, echo = F, warning = F, message = F}
df_wce$tactical_choice <- as.integer(df_wce$tactical_choice)

# checkWCE(as.data.frame(df_wce), id = "id", event = "concessions", start = "Start",
#          stop = "Stop", expos = "tactical_choice")

```

```{r, echo = F, warning = F, message = F}
df_wce <- df_wce %>% 
  dplyr::select(id, date, geo_scope, actor_id, camp_goals, tactical_choice, damage, econ_impact,
                fatal_casu, injuries,
                concessions, num_protests_day)
df_wce$damage <- as.double(df_wce$damage)
df_wce$econ_impact <- as.double(df_wce$econ_impact)
df_wce[is.na(df_wce$damage), c("damage")] <- 0
df_wce[is.na(df_wce$econ_impact), c("econ_impact")] <- 0
df_wce[is.na(df_wce$fatal_casu), c("fatal_casu")] <- 0
df_wce[is.na(df_wce$injuries), c("injuries")] <- 0
#df_wce[is.na(df_wce$num_partic_event), c("num_partic_event")] <- 0
df_wce$doy <- as.double(strftime(df_wce$date, format = "%j"))
```

```{r, echo = F, warning = F, message = F}
df_wce$geo_scope <- as.character(df_wce$geo_scope)
df_wce$actor_id <- as.character(df_wce$actor_id)
df_wce$camp_goals <- as.character(df_wce$camp_goals)

non_protest_day_maker <- function(df) {
  ly <- seq(from = 1992, to = 2012, by = 4) # years that are leap years
  year <- as.double(format(date, "%Y")) # extract year
  days_ly <- 1:366
  days_nly <- 1:365
  ly_indicator <- year %in% ly
  ly_newdays <- days_ly[!(1:366) %in% df$doy]
  nly_newdays <- days_nly[!(1:365) %in% df$doy]
  if(ly_indicator) {
    days_to_add <-days_ly[!(1:366) %in% df$doy]
  }
  else {
    days_to_add <- days_nly[!(1:365) %in% df$doy]
  }
  num_rows <- length(days_to_add)
  id <- df$id[1]
  zeros <- rep(0, num_rows)
  new_rows <- bind_cols(rep(id, num_rows), rep(as.Date("1982-01-13", format = "%m/%d/%y"), num_rows), rep("", num_rows), rep("", num_rows), #id, date, geo_scope, actor_id
                    rep("", num_rows), zeros, zeros, # camp_goals, tactical_choice, damage
                    zeros, zeros, zeros, # econ_impact, fatal_casu, injuries
                    zeros, zeros, # num_partic_event, concessions, num_protests_day
                    days_to_add) # doy 
  colnames(new_rows) <- c("id", "date", "geo_scope", "actor_id", "camp_goals",
                          "tactical_choice", "damage", "econ_impact", "fatal_casu", "injuries",
                          "concessions", "num_protests_day", "doy")
  df_comb <- rbind(df, new_rows)
  return(df_comb)
}
```

```{r, echo = F, warning = F, message = F}
df_wce_final <- df_wce %>% group_by(id) %>% 
  #group_map(~non_protest_day_maker(.x))
  do(data.frame(non_protest_day_maker(.))) %>% 
  arrange(id, doy) %>% 
  ungroup()

df_wce_final <- df_wce_final %>% group_by(id) %>% 
  dplyr::mutate(Start  = doy - 1) %>% 
  dplyr::mutate(Stop = doy) %>% 
  dplyr::select(-c("date", "doy", "actor_id", "camp_goals"))

df_wce_final$geo_scope <- as.double(ordered(df_wce_final$geo_scope, levels = c("", "local", "regional", "national", "international regional", "global")))

```

```{r, echo = F, warning = F, message = F}
# match start dates to match events with complete information
df_pwp_final <- df_pwp

# convert id to a double
df_pwp_final$id <- as.double(df_pwp_final$id)

# get number of protests that led to concessions
df_pwp_final <- df_pwp_final %>% 
  group_by(id) %>% 
  dplyr::mutate(row_count = row_number()) %>% 
  filter(concessions == 1 | row_count == max(row_count)) %>% 
  # dplyr::mutate(enum = if_else(concessions == 1,
  #                              row_number(),
  #                              as.integer(0))) %>% 
  dplyr::mutate(enum = row_number()) %>% 
  dplyr::mutate(enum = if_else(enum >= 8, 8, as.double(enum))) %>% 
  ungroup()

# match start dates to events with complete info
df_pwp_final <- df_pwp_final %>% 
  group_by(id) %>% 
  dplyr::mutate(Start = lag(Stop)) %>% 
  ungroup()
df_pwp_final$Start[is.na(df_pwp_final$Start)] <- 0

# continent variable
df_pwp_final <- df_pwp_final %>% 
  dplyr::mutate(region = case_when(country_name %in% c("algeria", "egypt",
                                                   "kenya", "libya", 
                                                   "madagascar", "morocco",
                                                "sierra_leone", "south_sudan",
                                                "sudan", "tanzania", "tunisia") ~ "Africa",
                               country_name %in% c("iraq", "jordan", "syria",
                                                   "turkey", "yemen") ~ "Middle East",
                               country_name %in% c("bahrain", "china", 
                                                   "india", "pakistan",
                                                   "south_korea", "uzbekistan") ~ "Asia",
                               country_name %in% c("estonia", "ukraine") ~ "Europe",
                               TRUE ~ "Americas")) # Mexico, U.S.
```

<!-- Chilling Effect Data Cleaning -->

```{r, echo = F, warning = F, message = F}
df_chill <- df_clean %>% 
  filter(target_3 %in% c("COP", "GOV", "JUD", "MIL", "LLY", "SPY", "LEG", "TOP")) %>% 
  dplyr::mutate(repress = as.double(st_posture) %in% 5:7) %>% 
  group_by(repress) %>% 
  dplyr::mutate(repress_id = as.double(row_number())) %>% 
  dplyr::mutate(repress_id = if_else(repress, repress_id, 0)) %>% 
  ungroup()
```

```{r, echo = F, warning = F, message = F}
df_chill_condense <- df_chill[, c("country_name", "date")]
# functions to tell if events fell within a year of a repressive response
prior_detector <- function(repress_id, date, country){
  temp <- df_chill_condense %>% 
    filter(country_name == country)
  dates <- temp$date
  fun <- sum(date - 365 < dates & date > dates) 
  num <- ifelse(repress_id > 0, fun, 0)
  return(num)
}

# near_detector <- function(repress_id, date, country){
#   temp <- df_chill_condense %>% 
#     filter(country_name == country)
#   dates <- temp$date
#   fun1 <- sum(date - 365 < dates & date > dates) 
#   fun2 <- sum(date < dates & date + 365 > dates)
#   num1 <- ifelse(repress_id > 0, fun1, 0)
#   num2 <- ifelse(repress_id > 0, fun2, 0)
#   return(list(num1, num2))
# }

post_detector <- function(repress_id, date, country){
  temp <- df_chill_condense %>% 
    filter(country_name == country) 
  dates <- temp$date
  fun <- sum(date < dates & date + 365 > dates)
  num <- ifelse(repress_id > 0, fun, 0)
  return(num)
}

prior_detector <- Vectorize(prior_detector)
post_detector <- Vectorize(post_detector)
```

```{r, echo = F, warning = F, message = F}
# vectorize? Takes a couple minutes to run
df_chill_final <- df_chill %>% 
  dplyr::mutate(prior = prior_detector(repress_id, date, country_name)) %>% 
  dplyr::mutate(post = post_detector(repress_id, date, country_name))
```

```{r, echo = F, warning = F, message = F}
df_chill_fn <- df_chill_final %>% 
  filter(repress_id > 0)
```

```{r, echo = F, warning = F, message = F}
# chilling effect eda
df_chill_eda <- df_chill_fn %>% 
  pivot_longer(cols = c("prior", "post"),
             names_to = "Timing",
             values_to = "freq_protests")

mu <- ddply(df_chill_eda, "Timing", summarise, grp.mean = mean(freq_protests))
```

## Exploratory Data Analysis
```{r, echo = F, warning = F, message = F, fig.width = 13}
# EDA visualization for showing x = government response, y = number of participants, color = participant goals
# df_eda1 <- df_clean[, c("num_partic_event", "st_posture", "camp_goals")]
# df_eda1 <- df_eda1[complete.cases(df_eda1),]
# 
# (p1 <- ggplot(data = df_eda1, aes(st_posture, log(num_partic_event))) +  
#   #facet_grid(.~CRIME_SEV) +
#   geom_jitter(aes(color = camp_goals),alpha = 0.5) +  
#   labs(x = "Government Response", y = "Number of Participants", 
#        title = "Figure 1: Regime Change Associated with More Forceful Regime Responses",
#        colour = "Participant Goals") +
#   theme_light() +
#   ylim(0, 2000000) + # omit one observation with high participant count
#   theme(plot.title = element_text(hjust = 0.5),
#         plot.subtitle = element_text(hjust = 0.5))) 
```

```{r, echo = F, warning = F, message = F, fig.height = 4}
ggplot(df_chill_eda, aes(x = freq_protests, color = Timing)) +
  geom_histogram(binwidth = 100) +
  geom_density(alpha = 0.2) +
  geom_vline(data = mu, aes(xintercept = grp.mean, color = Timing),
             linetype = "dashed") + 
  labs(title = "Higher Incidence of Low Protest Frequencies After Severe Responses",
       subtitle = "However, Densities Look Similar and Difference Between Means is Moderate",
       x = "Protest Frequency", 
       y = "Count")
```

To help understand our third research question on the chilling effect, we created non-stacked histograms that show the distributions of the number of protests in the years before and after repressive events. We can see that for both timing values, the distributions appear to peak for the bar corresponding to between 100 and 200 protests. While the distrsibutions look similar in shape, there is a much greater count of low protest frequencies for the post timing, and the means of each distribution, visualized by the vertical dashed lines, indicate that the post sample mean frequency is lower than the prior sample mean frequency.

# Methodology

## Determinants of Protest Success

To determine how and if certain factors are associated with individual protest success, we opted for an ordinal logistic regression model, otherwise known as a cumulative logit model for ordinal responses. Protest success will be simply defined as the response used by the government, with full accomodation denoting the lowest level of the outcome and material and/or physical repression resulting in death denoting the highest. As such, lower levels of the outcome signify more successful protests, while higher ones signify less successful ones that elicited a more negative governmental response. The response variable has seven levels in total. Since we are examining a classification problem with ordered classes, it would not be appropriate to use a multinomial logistic regression model nor other similar models for nominal variables. Other classes of models, including the ordered probit model, are also commonly implemented for classification problems involving an ordinal response variable. In contrast to the ordered probit model, logistic regression affords greater interpretability; the coefficients $\beta$ in logistic regression allow for natural interpretations in terms of log odds. Hence, the logit link function is preferrable since the stated goals focus primarily on the interpretability of the predictors' relationships with the response. A cumulative logit model for an ordinal response with $J$ levels is similar to a binary logistic model, as the levels 1 to $j$ form a single category and the levels $j+1$ to J form a second category. The log-odds of falling at or below the category comprised of levels 1 to $j$ has a linear relationship with the predictors. The logits of the cumulative probabilities are therefore given by the following form:

$$ logit(P(Y \leq j)) = log(\frac{P(Y \leq j)}{P(Y > j)}) = \alpha_j + \beta x, \ for \ j = 1, \ 2 \ ... \ J-1 $$

The key assumption underpinning the ordinal logistic regression model is the proportional odds assumption, which implies that only a single set of coefficients is necessary for each covariate in the model. This is because the assumption states that the coefficients that describe the relationship between the lowest ordinal category versus all higher categories are the same as those that describe the relationship between the next lowest category and all higher categories, and so on. To determine how well each predictor upholds the proportional odds assumption, we created a function to calculate the log odds that governmental response was greater or equal to a given level of governmental response from individual logistic regressions with a single predictor. We then tested the equality of coefficients for a given predictor across its corresponding binary logistic regression models. The differences between the logits for each partition of the dependent variable should be similar for a given predictor regardless of that predictor's level if the proportional odds assumption holds. A visualization indicating the validity of the proportional odds assumption for our predictor set has been included in the Appendix. For each category of given predictor, the differences between the logits is relatively similar for the included covariates. There are no particularly egregious deviations from the assumption, which verifies our choice of an ordinal logistic regression. A partial proportional odds model, an extension of the cumulative logit model that allows coefficients to vary for each predictor and relaxes the proportional odds assumption, was also considered. We ultimately decided against the use of this more complex model, given that the proportional odds assumption was largely upheld and this model is harder to interpret given that it involves the estimation of $M-1$ coefficients for a predictor with $M$ coefficients. It is also potentially less robust than the cumulative logit model given that it involves coefficient estimation using sparser partitions of the dataset (Lall). 

The model containing relevant protest-level predictors is specified below:

$$
\begin{aligned}
logit(P(GovernmentResponse_i \leq j)) &= \beta_{0j} + \beta_1 I(GeoScope_i = Regional) \\
&+ \beta_2 I(GeoScope_i = National) + \beta_3 I(GeoScope_i = International \ Regional) \\
&+ \beta_4 I(GeoScope_i = Global) + \beta_5 I(ActorID_i = International) \\
&+ \beta_6 I(ActorID_i = Non-State) + \beta_7 I(CampGoals_i = Institutional \ Reform) \\
&+ \beta_8 I(CampGoals_i = Policy \ Change) + \beta_9 I(CampGoals_i = Territorial \ Secession) \\
&+ \beta_{10} I(CampGoals_i = Autonomy) + \beta_{11} I(CampGoals_i = Unknown) \\
&+ \beta_{12} I(Tactics_i = Mixed) + \beta_{13} I(Tactics_i = Violent) \\
&+ \beta_{14} I(Region_i = Americas) + \beta_{15} I(Region_i = Asia) \\
&+ \beta_{16} I(Region_i = Europe) + \beta_{17} I(Region_i = Middle \ East) \\
& for \ j = 1, \ 2, \ 3, \ 4, \ 5, \ 6, \ 7
\end{aligned}
$$

## Cumulative Protest Effects 

The success of a campaign was modeled using a survival analysis framework. In this framework, concessions are the event of interest. Although there may be multiple protests that result in concessions across the course of a campaign year, we evaluated the time to the first protest within a campaign that resulted in a concession. 

Protests do not occur in a vacuum; oftentimes, individual protests are part of a much larger campaign designed to bring about sweeping institutional change. Given this, we posit that there are likely to be cumulative effects of protests on concession obtainment, whereby past protests influence the success of future ones within the same campaign. We followed the inclusion rule used by Pinckney that approximates the definition of a campaign within the civil resistance literature. A campaign must consist of at least three distinct physical events separated by less than one year, with the events meaningfully linked through common actors or goals [5]. To categorize event-level data into campaigns, we used the NAVCO 2.0 and 1.3 list of non-violent and violent campaigns. Since NAVCO 3.0 is a disaggregated dataset that does not sort individual protests into campaigns, we analyzed the stated protest goals, target, country, and timing of the events in our dataset and assigned protests to the campaigns with which they are most closely aligned. Pursuant to the approach used to create the NAVCO 2.0 dataset, protests are then further sorted into 'campaign years' such that protests within campaigns spanning multiple years are grouped by the year in which they occurred (Chenoweth & Lewis). Protests that do not clearly seem to be part of any campaign were discarded.

Once the individual protests were sorted into their respective campaigns, we used a weighted cumulative exposure (WCE) model, which was integrated into a traditional Cox Proportional Hazards model framework. This is sensible because we are assessing the 'hazard' of acheiving concessions accounting for certain campaign characteristics. The WCE function effectively assigns a weight to a protest in terms of its influence on later protests. The WCE model has broad applications within the field of pharmacoepidemiology, and the Cox model is preferable to the Accelerated Failure Time (AFT) model given the inherent difficulty with choosing an appropriate distribution for the error term in the AFT model. Given the novelty of research on protest success within campaigns, there is a substantial dearth of the necessary prior information and domain knowledge required to specify a distribution for the error distribution. In this case, the WCE extension of a traditional Cox model is advantageous for three reasons. First, it is able to capture the cumulative effect of past protests on concessions. Second, it is able to weight the relative importance of past protests depending on their timing. Finally, information concerning the 'intensity' of each protest event is integrated into the WCE model through an exposure variable. Here intensity is operationalized as the tactics used by the participants in the protest, which is represented by the three-level ordinal variable. The lowest level denotes protests that were primarily non-violent and the highest level denotes protests that were primarily violent; the remaining level denotes protests that employed a mix of violent and non-violent tactics. By accounting for protesters' tactical choices, we can observe the association between protest type and the hazard of obtaining concessions. This variable is of great interest because governments would be expected to respond in different fashions depending on the level of violence that protesters utilize. We chose this model over recurrent event models such as the Anderson-Gill (AG) model, which suffer from the independence assumption. The AG model assumes that the instantaneous risk of experiencing an outcome of interest at time $t$ remains the same irrespective of whether or not previous events have been experienced. This makes recurrent event independence a poor assumption for this problem. The WCE model is specified as follows:

$$
\begin{aligned}
WCE(u) &= \sum_{t \leq u} w(u-t)X(t) \\
X(t) &= Tactics_k \  \text{at time t}
\end{aligned}
$$

Here $u$ is the current time when concession acquisition is evaluated, $t \leq u$ indexes the times of protests preceding $u$, $k$ indexes individual protests, and $X(t)$ represents the past protest tactical intensity at time $t$. Since protests are sorted into campaign years, we represent time as the number of days to protest that have elapsed since the beginning of the year. Given that our ultimate reponse variable of interest is binary, we will follow the Danieli et al. procedure for implementing the WCE model to assess longitudinal changes in the outcome [6]. This WCE model will be incorporated into a Cox model as mentioned previously, whereby we model concessions, a repeated-over-time outcome, at the $k^{th}$ protest for campaign $i$. The model will thus take the form below:

$$
\begin{aligned}
\lambda_i(t) &= \lambda_{0}(t)exp[\beta_{WCE}WCE_i(t_{ik}) \\
&+ \beta_1GeographicScope_{ik} + \beta_2Damage_{ik} \\
&+ \beta_3EconomicImpact_{ik} + \beta_4FatalCasualties_{ik} \\
&+ \beta_5Injuries_{ik} + \beta_6DailyProtestCount_{ik} + \epsilon_{ik}]
\end{aligned}
$$

As is typical for a Cox Proportional Hazards model, $\lambda_{i,0}$ is not estimated. The $\beta$ coefficients independently consider the time-varying covariates shown in this model. $\lambda_i(t_{ik})$ gives the instantaneous rate of acheiving of a successful protest given that no previous protests have been successful at time $t$. 

## Chilling Effect

To determine whether or not a chilling effect stemming from severe governmental responses exists, we examined the frequency of protests within a country a year prior to and following such a response. A severe response is defined as any governmental response that is of level five, which corresponds to non-material and non-physical repression, or higher. As our outcome of interest, the frequency of protests, is a discrete count, we decided to use a count model. We initially considered using a Poisson regression model, but found statistically significant evidence for overdispersion, violating Poisson regression's assumption of equal conditional mean and variance and potentially resulting in understated standard error estimates. The overdispersion test of the Poisson model in the Appendix gave us a value of 199.540 at a p-value that was well below the $\alpha = 0.05$ level, allowing us to address the null hypothesis of equidispersion. We therefore implemented a Negative Binomial regression model that is better equipped to deal with overdispersion given that the negative binomial distribution has an additional parameter that adjusts variance independently from the mean. Zero-inflated models were also considered to also account for overdispersion, but these approaches were deemed unecessary given that only 28 protest frequency counts out of 10,314 were equal to zero. We also considered constructing a Negative Binomial model with the difference between prior- and post-frequencies as the outcome, but this approach was not ideal given that the outcome variable for count models is constrained to the set of non-negative integers. Consequently, the implementation of this model would have required evaluating the absolute differences between frequencies, resulting in substantive information loss since we are interested in the directionality of these differences. With regard to the validity of our Negative Binomial model for the research question, the main assumptions are linearity of the model parameters with the response and independence among observations. While there is invariably going to be some dependency among the pairs of observations corresponding to the before and after frequencies of protests following the same protest event, model diagnostics verify that residuals do not show any particularly alarming systematic patterning. The linearity assumption is similarly upheld. The Negative Binomial model is specified as follows: 

$$
\begin{aligned}
log(\mu_i) &= \beta_0 + \beta_1I(Timing_i = Prior) + \beta_2I(Region_i = Americas) \\
&+ \beta_3I(Region_i = Asia) + \beta_4I(Region_i = Europe) + \beta_5I(Region_i = Middle \ East) \\
&+ \beta_6I(GeographicScope_i = Regional) + \beta_7I(GeographicScope_i = National) \\
&+ \beta_8I(GeographicScope_i = International) + \beta_9I(GeographicScope_i = Global) \\
&+ \beta_{10}I(ActorID_i = Non-State) + \beta_{11}I(ActorID_i = International) \\
&+ \beta_{12}I(ActorID_i = Non-Aligned) + \beta_{13}I(CampaignGoals_i = Institutional \ Reform) \\
&+ \beta_{14}I(CampaignGoals_i = Policy \ Change) + \beta_{15}I(CampaignGoals_i = Territorial \ Secession) \\
&+ \beta_{16}I(CampaignGoals_i = Autonomy) + \beta_{17}I(CampaignGoals_i = Anti-Occupation) \\
&+ \beta_{18}I(CampaignGoals_i = Unknown) + \beta_{19}I(Tactics_i = Mixed) \\
&+ \beta_{20}I(Tactics_i = Violent) + \beta_{21}I(GovernmentResponse_i = Short \ of \ Killings) \\
&+ \beta_{22}I(GovernmentResponse_i = Intended \ to \ Kill) + \beta_{23}Year_i + \epsilon_i
\end{aligned}
$$

$$\text{P}(ProtestFrq = ProtestFrq_i | \mu_i, \alpha) = \frac{\Gamma(ProtestFrq_i + \alpha^{-1} )}{\Gamma(\alpha^{-1})\Gamma(ProtestFrq_i + 1)} \left(\frac{1}{1 + \alpha\mu_i}\right )^{\alpha^{-1}} \left(\frac{\alpha\mu_i}{1+\alpha\mu_i}\right)^{ProtestFrq_i}$$

For the Negative Binomial model, $i$ represents each frequency observation, $\alpha$ is the dispersion parameter, and $\mu_i$ is the mean frequency for a given observation. The covariate of interest is timing, which is an indicator variable that denotes whether the count was observed before or after the repressive event. Additional covariates corresponding to the features of the protest that triggered the repressive event and the severity of repression itself were included to control for confounding effects. 

For sensitivity analysis, we also evaluated the difference between prior- and post-repression protest frequencies using more simplistic approaches that do not control for confounders to assess potential discrepancies in findings. A Welch's T-test was used to determine if the difference between protest frequencies is statistically significant. This method is more robust than the frequently used Student's t-test that assumes equal variances. Bootrstrapping was then implemented to randomly sample from our dataset and obtain more robust confidence intervals with reduced bias. This is due to the fact that the distribution of a large number of repeatedly estimated mean differences is symptotically equivalent to the sampling distribution of the difference. 

# Results 

## Protest Success

```{r, echo = F, warning = F, message = F}
m_ord <- polr(st_posture ~ factor(geo_scope, order = F) + actor_id + camp_goals + tactical_choice +
                region,
          data = df_ord, 
          #na.action = na.omit,
          Hess = TRUE)
#summary(m_ord)
mod_output_df <- as.data.frame(summary(m_ord)$coefficients)
mod_output_df$p_value <- pnorm(abs(mod_output_df[, "t value"]), lower.tail = FALSE) * 2
mod_output_df$CI <- paste("(", as.character(mod_output_df$Value - 1.96 * mod_output_df$`Std. Error`), ", ", as.character(mod_output_df$Value + 1.96 * mod_output_df$`Std. Error`), ")")
#mod_output_df[, c("Value", "Std. Error", "p_value", "CI")]


#1-pchisq(deviance(m_ord), df.residual(m_ord))
pres <- presid(m_ord)
#ggplot(data.frame(y = pres), aes(sample = y)) +
#  stat_qq(distribution = qunif, dparams = list(min = -1, max = 1), alpha  = 0.5)

#summary(m_ord)
#resids(m)
#predict(m_ord, type = "probs")
#autoplot(resids(m_ord), what = "covariate", x  = predict(m, type = "probs"))

#residuals(m_ord)
```
| Term    | Estimate  | Standard Error |p.value| 95% CI
|--------------------------|-----|-----|---|----------
| Geographic Scope = Regional|0.717 |0.056 |<0.001|0.607 to 0.827|
| Geographic Scope = National|-0.425 | 0.070|<0.001|-0.563 to -0.287|
| Geographic Scope = International|0.448 | 0.163|0.006|0.128 to 0.767|
| Geographic Scope = Global| 0.001| 0.135|0.994|-0.264 to 0.266|
| Actor ID = International| 0.403| 0.342|0.239|-0.268 to 1.073|
| Actor ID = Non-State| 1.539| 0.254|0.506|-0.328 to 0.666|
| Campaign Goals = Institutional Reform|-0.654| 0.079|<0.001|-0.808 to -0.499|
| Campaign Goals = Policy Change|-1.236| 0.064|<0.001|-1.361 to -1.111|
| Campaign Goals = Territorial Secession|-1.161| 0.085|<0.001|-1.328 to -0.993|
| Campaign Goals = Autonomy|-1.255| 0.094|<0.001|-1.439 to -1.071|
| Campaign Goals = Unknown|-1.412| 0.071|<0.001|-1.552 to -1.272|
| Tactical Choice = Mixed|2.147| 0.042|<0.001|2.066 to 2.229|
| Tactical Choice = Violent|-0.232| 0.061|<0.001|-0.351 to -0.112|
| Region = Americas |0.177| 0.087|0.040|0.008 to 0.347|
| Region = Asia |0.170| 0.055|0.002|0.063 to 0.277|
| Region = Europe |-0.786| 0.134|<0.001|-1.049 to -0.523|
| Region = Middle East |0.872| 0.054|<0.001|-0.766 to 0.978|

The ordinal logistic regression model had the above coefficient estimates and measures of uncertainty. At the $\alpha = 0.05$ significance threshold, the coefficient point estimates are statistically significant for the following variables: regional scope, national scope, international scope, all campaign goal variables, all tactical choice variables, and all region variables. Despite correlative evidence from reviewing relevant literature, the identity of the actors involved in a protest was not statistically significant.  

## Cumulative Protests

```{r, echo = F, warning = F, message = F}
#checkWCE(as.data.frame(df_wce_final), id = "id", event = "concessions", start = "Start",
#         stop = "Stop", expos = "tactical_choice")
m_wce <- WCE(as.data.frame(df_wce_final), analysis = "Cox", cutoff = 366, nknots = 1:3, 
    constrained = "R", aic = FALSE, MatchedSet = NULL,
    id = "id", 
    event = "concessions", 
    start = "Start", stop = "Stop", expos = "tactical_choice",
    covariates = c("geo_scope", "damage", "econ_impact", "fatal_casu", "injuries",
                   "num_protests_day"))
#m_wce
#summary(m_wce)
#plot(m_wce)

# Scenario Analysis
nonvio <- rep(1, 366)
mixed <- rep(2, 366)
# for all models
#HR.WCE(m_wce, mixed, vio, allres = TRUE)

vio <- rep(3, 366)
# for all models
#HR.WCE(m_wce, nonvio, vio, allres = TRUE)
```
| Comparison    | Hazard Ratio  
|------------------------|-----
| Daily Non-Violent Protests vs. Mixed Protests|33.926 |
| Daily Non-Violent Protests vs. Violent Protests|1150.949 |
| Daily Mixed Protests vs. Violent Protests|33.926 |

To evaluate the relationship between protest tactics and the hazard of a protest within a campaign year resulting in a concession, we conducted a scenario analysis. After fitting the WCE Cox proportional hazards model, three scenarios were simulated. Each scenario is represented by a vector of tactical choice values in which each element of the vector denotes the tactics that were used on a given day within a hypothetical campaign year. The first assumes that a primarily non-violent protest occurred every single day during the 366 potential days in a given year. The second and third scenarios respectively assume daily mixed and primarily violent protests in a similar fashion. This method was utilized because it offers the clearest insight into how the cumulative effects of protests differ with respect to the tactics used in the protests. The hazard ratios in the table above signify the relative risk of one campaign year obtaining a concession at time $t = 366$ in comparison to another campaign year (Sylvestre). The scenario that is listed first within each row corresponds to the numerator of the appropriate hazard ratio, while the second scenario corresponds to the denominator. An interpretation of the findings is provided in the discussion section. 

| Term    | Estimate  | Standard Error |p.value| 95% CI
|--------------------------|-----|-----|---|----------
| Geographic Scope |1.002 |0.089 |<0.001|0.828 to 1.176|
| Damage|1.766 | 0.223|<0.001|1.329 to 2.203|
| Economic Impact|0.628 | 0.155|<0.001|0.324 to 0.932|
| Fatal Casalties| -1.661| 0.443|<0.001|-2.530 to -0.792|
| Injuries| -0.097| 0.063|0.1225|-0.220 to 0.0262|
| Daily Protest Count| 0.727| 0.121|<0.001|0.490 to 0.964|

The WCE Cox model had the above coefficient estimates and measures of uncertainty for the other covariates. At the $\alpha = 0.05$ significance threshold, the coefficient point estimates are statistically significant for every predictor with the exception of injuries. Caution should be exercised when interpreting any significant effect sizes, as some variables that are truly ordinal are treated as continuous due to the constraints of the current implementation of the WCE package. We will articulate how to interpret these results in the discussion.

```{r, echo = F, warning = F, message = F}
pwp1 <- coxph(Surv(Stop, concessions) ~ cluster(id)+ strata(enum) + factor(tactical_choice, order = F) * strata(enum) 
              + region * strata(enum) + factor(geo_scope, order = F) * strata(enum) + 
                factor(camp_goals, order = F) * strata(enum), 
            data = df_pwp_final)

# summary(pwp1)

# Residual plots

# ggcoxdiagnostics(pwp1, type = "deviance", linear.predictions = T) +
#   labs(title = "Deviance Residuals",
#          x = "Linear Predictions",
#          y = "Residuals") + 
#   xlim(c(-5,5))
# 
# ggcoxdiagnostics(pwp1, type = "deviance", linear.predictions = F) +
#   labs(title = "Deviance Residuals",
#          x = "Linear Predictions",
#          y = "Residuals")
```

## Chilling Effect

```{r, echo = F, warning = F, message = F}
# t test for difference between two populations, may be biased
#t.test(x = df_chill_fn$prior, y = df_chill_fn$post)

# bootstrap the mean difference of the two samples
bootstrapped <- two.boot(df_chill_fn$prior, df_chill_fn$post, mean, 10000)

bootstrapped_mean_diff <- data.frame(bootstrapped$t)
colnames(bootstrapped_mean_diff) <- "mean_diffs"

ggplot(bootstrapped_mean_diff, aes(x = mean_diffs)) +
  geom_histogram(color = "green", bins = 20, alpha = 0.8) +
  geom_vline(xintercept = bootstrapped$t0, size = 1.5) +
  geom_vline(xintercept = quantile(bootstrapped_mean_diff$mean_diffs, 0.025), size = 1, 
             linetype = "dashed") +
  geom_vline(xintercept = quantile(bootstrapped_mean_diff$mean_diffs, 0.975), size = 1,
             linetype = "dashed") +
  labs(title = "Statistically Significant Evidence that Means are not the Same",
       x = "Sample Mean Difference",
       y = "Bootstrapped Count")
```

The Welch's T-test gave us an expected true mean difference of 54.53 between prior- and post-repression frequencies at a p-value that was well below the $\alpha = 0.05$ threshold. The plot above shows the distribution of the sample mean differences, as well as the estimate for the true mean difference with the bootstrapped confidence interval.

```{r, echo = F, warning = F, message = F}
# create continent variable
df_chill_glm <- df_chill_eda %>% 
  dplyr::mutate(region = case_when(country_name %in% c("algeria", "egypt",
                                                   "kenya", "libya", 
                                                   "madagascar", "morocco",
                                                "sierra_leone", "south_sudan",
                                                "sudan", "tanzania", "tunisia") ~ "Africa",
                               country_name %in% c("iraq", "jordan", "syria",
                                                   "turkey", "yemen") ~ "Middle East",
                               country_name %in% c("bahrain", "china", 
                                                   "india", "pakistan",
                                                   "south_korea", "uzbekistan") ~ "Asia",
                               country_name %in% c("estonia", "ukraine") ~ "Europe",
                               TRUE ~ "Americas")) # Mexico, U.S.

# Poisson Model
m_chill_poiss <- glm(freq_protests ~ Timing + region + geo_scope + 
                       actor_id + camp_goals + tactical_choice + st_posture + year, 
                     data = df_chill_glm, family = poisson)
#summary(m_chill_poiss)

# significant evidence of overdispersion
#dispersiontest(m_chill_poiss)

# Negative Binomial Model 
m_chill_nb <- glm.nb(freq_protests ~ Timing + region + factor(geo_scope, order = F) + 
                       actor_id + camp_goals + factor(tactical_choice, order = F) + st_posture + year, 
    data = df_chill_glm)

# Negative Binomial Model for mean differences
df_chill_diff <- df_chill_glm %>% 
  group_by(repress_id) %>% 
  dplyr::mutate(diff = freq_protests[Timing == "prior"] - freq_protests) %>% 
  slice_tail() %>% 
  ungroup()
m_chill_nb_diff <- glm.nb(abs(diff) ~ region + geo_scope + 
                       actor_id + camp_goals + tactical_choice + st_posture + year, 
    data = df_chill_diff)

#summary(m_chill_nb_diff)
#summary(m_chill_nb)
# plot(m_chill_nb$fitted.values,m_chill_nb$residuals, xlab = "Fitted Values", ylab = "Pearson Residuals", main = "Residual Plot Shows No Pattern in Residuals")
# plot(m_chill_nb_diff$fitted.values,m_chill_nb_diff$residuals, xlab = "Fitted Values", ylab = "Pearson Residuals", main = "Residual Plot Shows No Pattern in Residuals")
nb_table <- tidy(m_chill_nb)
nb_table$lower <- nb_table$estimate - 1.96 * nb_table$`std.error`
nb_table$upper <- nb_table$estimate + 1.96 * nb_table$`std.error`
# knitr::kable(nb_table, digits = 3, caption = "Negative Binomial Model for Chilling Effect", col.names = c('Term','Estimate', 'Standard Error', 'Statistic' , 'P-Value', "Lower", "Upper")) %>%
#   kable_styling(latex_options = "HOLD_position")
```

| Term    | Estimate  | Standard Error |p.value| 95% CI
|--------------------------|-----|-----|---|----------
| Timing = Prior|-0.004 |2.696 |0.818|-0.034 to 0.027|
| Region = Americas|-0.099 | 0.040|0.014|-0.178 to -0.020|
| Region = Asia|0.244 | 0.023|<0.001|0.198 to 0.289|
| Region = Europe| -0.637| 0.080|<0.001|-0.795 to -0.480|
| Region = Middle East| 0.582| 0.021|<0.001|0.541 to 0.622|
| Geographic Scope = Regional| -0.090| 0.024|<0.001|-0.138 to -0.042|
| Geographic Scope = National|0.055| 0.034|0.108|-0.012 to 0.121|
| Geographic Scope = International|0.139| 0.080|0.081|-0.017 to 0.296|
| Geographic Scope = Global|0.224| 0.107|0.036|0.015 to 0.433|
| Actor ID = Non-State|-0.041| 0.138|0.767|-0.311 to 0.229|
| Actor ID = International|-0.468| 0.179|0.009|-0.311 to 0.229|
| Actor ID = Non-Aligned|-1.035| 0.585|0.077|-2.181 to 0.111|
| Campaign Goals = Institutional Reform|-0.764| 0.030|<0.001|-0.823 to -0.706|
| Campaign Goals = Policy Change |-0.767| 0.026|<0.001|-0.819 to -0.715|
| Campaign Goals = Territorial Secession |-0.474| 0.032|<0.001|-0.537 to -0.411|
| Campaign Goals = Autonomy|-1.063| 0.032|<0.001|-1.126 to -1.000|
| Campaign Goals = Anti-Occupation |-0.833| 0.256|0.001|-1.335 to -0.330|
| Campaign Goals = Unknown|-0.672| 0.025|<0.001|-0.772 to -0.622|
| Tactics = Mixed |-0.013| 0.030|0.658|-0.072 to -0.046|
| Tactics = Violent |-0.072| 0.023|0.002|-0.117 to -0.027|
| Government Response = Short of Killings |0.152| 0.022|<0.001|0.109 to 0.194|
| Government Response = Intended to Kill |0.052| 0.016|0.001|0.021 to 0.083|
| Year |0.085| 0.001|<0.001|0.082 to 0.087|

The Negative Binomial model had the above coefficient estimates and measures of uncertainty. At the $\alpha = 0.05$ significance threshold, the coefficient point estimates are statistically significant for the following variables: Americas region, Asia region, Europe region, Middle Eastern region, regional scope, global scope, international actor ID, all campaign goal covariates, violent tactics, both government response indicator variables, and year. Our primary covariate of interest, timing, was not statistically significant at the $\alpha = 0.05$ level and had a confidence interval that contained zero.

# Discussion

## Protest Success

There were several statistically significant relationships that we observed given our results. Beginning by looking at the geographic scope indicator variables, the odds of receiving a less repressive and, equivalently, a more conciliatory governmental response for protests that were regional in nature were expected to be approximately 2.048 times those for local protests, holding all else constant. A similar multiplicative odds increase of 1.565 was observed for international protests compared to local protests, while a multiplicative odds decrease of 0.654 was observed for national protests. Regional protests may be more successful than local ones in acheiving conciliatory responses because they are inherently larger, making it easier to acheive their goals. However, increasing scope only appears to work up to a certain point. The finding that national protests without international backing are less successful than local ones may stem from the threat that they pose to the regime, outweighing any benefits from greater scale. The higher efficacy of international protests compared to the baseline indicates a necessary precursor to large scale protest success: once international actors get involved in domestic issues, governments are seemingly more likely to acquiesce, whether it be to uphold their diplomatic relations or image in general. 

Somewhat counterintuitively, we observed negative effect sizes for all of the point estimates of coefficients corresponding to campaign goal variables. For protests with institutional reform, policy change, territorial secession, autonomy, and unknown goals, the odds of being a recipient of a more conciliatory government response, holding other predictors constant, were expected to be approximately 0.520, 0.291, 0.313, 0.285, and 0.244 times those for protests with regime change goals, respectively. This suggests a nuance to the previous findings concerning scope. Protests that seek to completely topple existing institutional structures would be expected to be driven by protesters that are more fervent about their goals, hence making these protests more forceful.

With regard to tactical choice, we observed that protests utilizing both violence and non-violence were associated with a much higher odds of being successful than primarily non-violent protests, while primarily violent protests displayed the opposite relationship with non-violent protests. Holding all else constant, mixed protests were expected to have 8.560 times greater odds of a more conciliatory response when compared to non-violent protests. On the other hand, violent protests were expected to have 0.79 times lower odds of a more conciliatory response when compared to non-violent protests, holding other variables constant. The inefficacy of pure violence illustrates that civil resistance components are crucial for influencing protest success. It appears that mixed protests may be the ideal candiate for protest tactics. The literature cited in the variable selection portion supports this idea in that mixed protests can both integrate younger demographics, increasing the size of the protest, and catpialize upon the use of more forceful techniques when necessary.

Finally, we examined the associations between our region covariates and the response. For protests occurring in the Americas, Asia, Europe, and the Middle East, the odds of being a recipient of a more conciliatory government response, holding other predictors constant, were expected to be approximately 1.194, 1.185, 0.456, and 2.392 times those for protests occurring in Africa, respectively. Given that the United States and Mexico are governed by democratic republic systems and the former is a highly developed country, and most of the Asian countries analyzed have undergone significant political liberalization as a result of globalization, it is reasonable that these the Americas and Asia are expected to have elevated odds of protest efficacy than Africa, as many African countries are less integrated into global economic and political affairs and are led by autocratic regimes that are generally less concerned with the concerns of their citizenry. As many governments in the Middle East are also authoritarian, it may seem puzzling that protests within this region have a much higher expected odds of a conciliatory response than those in Africa. We posit that this may be due to the greater incidence of organized militant groups in the Middle East that are capable of forcing governments to acquiesce to demands, or the potential skewing of the results due to revolutions such as the Arab Spring from 2010 to 2012. Finally, the observation that protests based in Europe appear even less efficacious than those in Africa likely stems from the fact that only protests within Ukraine and Estonia are analyzed for the European region. Although relatively democratic, these Baltic states were formerly part of the USSR and maintain tight control over their populations which is designed to unite citizens against the ever-looming threat of Russian annexation. An interesting vector of consideration stems from the idea of information flow, with both countries having state-owned mass media and Ukraine being ranked within the bottom half of all countries in terms of the 2017 World Press Freedom Index (RSF). Thus, even as these countries are more democratized than of their African counterparts, their governments may be better equipped to quash protests. 

## Cumulative Protests

When analyzing the hazard ratios of the different scenarios outlined in the methodology section, it becomes apparent that campaigns with consistent non-violent protests are associated with the highest hazard of experiencing a concession. Holding other predictors constant, campaign years consisting of daily non-violent protests were expected to have a 33.926 times higher hazard at the end of the year than campaign years consisting of daily mixed protests. Holding other predictors constant, campaign years consisting of daily non-violent protests were expected to have a 1150.949 times higher hazard at the end of the year than campaign years consisting of daily violent protests. Holding other predictors constant, campaign years consisting of daily non-violent protests were expected to have a 33.926 times higher hazard at the end of the year than campaign years consisting of daily mixed protests. These findings seem to convey that within the context of a campaign, repeated non-violent protests have much higher efficacy for eliciting concessions on the part of a governmental entity than both repeated mixed and violent protests. This offers an interesting contrast to the results obtained from the previous research question, as we observed statistically significant evidence that protests with mixed tactics were expected to have considerably higher odds of acheiving a more conciliatory response than protests with non-violent tactics. The discrepancy can ostensibly be reconciled by the different units of observation in each research question, and the fact that cumulative protest effects are accounted for in this cumulative analysis. While a mixed tactics that utilizes some form of violence may be advantageous for acheiving success in a single, isolated protest, governments appear to be more receptive to campaigns that capitalize primarily on civil resistance. This may be a result of threat perception. When faced with challenges to their power, governments tend to scale their use of coercion and repression to the perceived size of the threat, with greater repression being relied on when threats are seen as large (Ferrara). The fact that the hazard ratio comparing non-violent protests to violent ones is inordinately large offers confirmatory evidence of this interpretation, as recurring instances of primarily violent protests are very likely to be perceived as substantial threats to the regime.

Examining the additional time-varying covariates included in the model, we also notice several intriguing relationships. Holding other variables constant, a one unit increase in fatal protest casualties at time or day $t$ within a campaign year is associated with a 0.190 multiplicative decrease in the hazard. Similarly, one unit increase in the number of protests at time or day $t$ is associated with a 2.069 multiplicative increase in the hazard, holding all else constant. Geographic scope, damage, and economic impact were ordinal variables in the original dataset, so individual point estimates have no meaningful interpretations. However, we can still make note of the direction of these estimates to describe the general relationship between the predictors and the hazard of acheiving a concession. Geographic scope, damage, and economic impact are positively associated with the hazard. While our foremost goal was to analyze the cumulative effects of protests when accounting for tactics, these findings provide additional color to our conclusions. The three ordinal predictors and the number of protests on a single day covariate all relate to the size and/or disruptiveness of a protest within a campaign year. The positive associations indicate that campaigns with larger and more disruptive protests are at greater 'risk' to experience a concession at any given time. On the other hand, higher casualties are associated with lower hazard, which may be because governments with a history of using violence are fundamentally more difficult to coerce. This is consistent with our findings that repeated violent tactics are the least successful campaign strategy.

## Chilling Effect 

The Welch's T-test gave us statistically significant evidence that the true mean difference between prior- and post-repressive event frequencies was 54.53, with a bootstrapped 95`%` confidence interval ranging from 32.38 to 77.06286. This gave us some evidence that the incidence of protests is higher in the year preceding a repressive event than in the year after it, suggesting the existence of a chilling effect. While the Welch's T-test and bootstrapped confidence interval gave us initial statistically significant evidence of this effect, our Negative Binomial model did not give us compelling evidence that timing was truly meaningful. The timing variable, which indicates whether an observation occurred before or after a repressive event, was not statistically significant. Since our Negative Binomial model controls for other important covariates, we are unable to conclude that a chilling effect exists, and that the mean of the protest frequencies before a repressive event are truly different from the mean of the protest frequencies after a repressive event.  

## Implications 

On an individual protest level, we found that more ambitious protests that are aimed to change the regime within the country are associated with higher odds of being successful, perhaps because these are larger and more well-organized. We also saw from our ordinal model that protests that were mixed in their approach were associated with higher odds of achieving a more conciliatory government response than non-violent protests. However, for an individual campaign, the hazard ratios were the highest for repeated non-violent protests in the WCE model. This may indicate that once you take into account the cumulative effects of protests on government response, regimes are more likely to respond positively to repeated protests without any violence. In addition, we saw that greater geographic scope, damage, economic impact, and same-day protests within campaigns appeared be positively associated with the hazard of achieving a concession for a campaign. Finally, on the chilling effect question, we did not find any statistically significant evidence for a difference in the protest counts before and after a repressive event, indicating that protesters are not meaningfully dissuaded by repression. 

## Strengths and Weaknesses

Our analysis has several notable strengths. The first is the rigorous model selection procedures put in place for each model, in which the assumptions for each model were carefully evaluated and validated. The creativity of the approaches, such as using the WCE Cox model for cumulative effects question, was advantageous, as it allowed us to answer inquiries that existing procedures that have proved too challenging given existing procedures in the literature. The fact that protests were considered in tandem and in isolation was also useful, as it allowed us to differentiate between successful tactics for individual protests and those for campaigns. Several limitations of the analysis stem from the missingness in the dataset, with some variables missing tens of thousands of observations and even making imputation inappropriate. Certain variables, such as the number of protesters involved, would have been particularly useful. The manual coding of the dataset is also prone to errors, as well as the fact that information is taken second-hand from news reports. Finally, the WCE model implementation in R is constrained to a binary response variable and numeric or binary predictors, resulting in information loss and making it difficult to interpret variables that were truly ordinal.

## Future Directions

Future analyses should first focus on finding accurate information about the size of protests, either with regard to the number of protesters involved or the number of significant actors involved. Literature shows that this is an important factor for protest success, so analyzing these variables would be the next logical extension of our analysis. Additionally, future research should address the temporal-spatial component of protests, as nearby protests undoubtedly influence each other and protest success depend on a variety of time-varying factors as countries globalize and democratize. This would allow for a more rigorous understanding of how protests work and even interact with one another.

# References

[1] https://www.nytimes.com/interactive/2020/07/03/us/george-floyd-protests-crowd-size.html

[2] Chenoweth E, Pinckney J, Lewis O. "Days of rage: Introducing the NAVCO 3.0 dataset." SAGE. Journal of Peace Research. 55 (4): 524-534.

[3] Huet-Vaughn E. "Quiet Riot: Estimating a Causal Effect of Protest Violence." Working Paper. 1-41.

[4] McAdam D. "Tactical Innovation and the Pace of Insurgency." American Sociological Association. American Sociological Review. 48 (6): 735-754.

[6] Danieli C, Sheppard T, Costello R, Dixon W, Abrahamowicz M. "Modeling of cumulative effects of time-varying drug exposures on within-subject changes in a continuous outcome." SSMR. 29(9): 2554-2568.

[7] Lall, R. "The Application of Ordinal Regression Models in Quality of Life Scales used in Gerontology." University of Sheffield. 1-315.

[8] Chenoweth E, Lewis O (2013). "Nonviolent and Violent Campaigns and Outcomes (NAVCO) Data Project." Journal of Peace Research. 1-19. 

[9] (RSF). https://rsf.org/en/ranking/2017

[10] Sylvestre M, Beauchamp M, Abrahamowicz M. "WCE package: weighted cumulative exposure models." CHUM Research Centre. 1-10.

[11] Ferrara F (2003). "Why Regimes Create Disorder: Hobbes's Dilemma during a Rangoon Summer." The Journal of Conflict Resolution. 47(3): 302-335.


# Appendix

# Protest Success: Data Dictionary 

| Variable                                                  | Definition                                                                                                                                                                                                    |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Governmental Response (outcome)                                  | Full accommodation, Material Concessions, Non-Material Concessions, Neutral, Non-Material and Non-Physical Repression, Material and/or Physical Repression Short of Killing, Material and/or Physical Repression Intended to Result in Death                                                                                                        |
| Geographic Scope                           | Local, Subnational or Regional, National, International Regional, Global                                                                                                  |
| Actor ID                               | State, International, Non-State  |
| Campaign Goals                         | Regime Change, Significant Institutional Reform, Policy Change, Territorial Secession, Greater Autonomy, Unknown                       |
| Tactics                                          | Primarily Non-Violent Event, Mixed Non-Violent and Violent Activity, Primarily Violent Event                           |
| Region                                          | Africa, Americas, Asia, Europe, Middle East  |

## Cumulative Protests: Data Dictionary

| Variable                                                  | Definition                                                                                                                                                                                                    |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Concessions (outcome)                                  |  Concessions Achieved (1), No Concessions (0)      |
| Tactics (exposure variable)                           | Primarily Non-Violent Event, Mixed Non-Violent and Violent Activity, Primarily Violent Event                       |
| Geographic Scope                               | Local, Subnational or Regional, National, International Regional, Global  |
| Direct Damage                         | Minor or No Property /Economic Damage,  Moderate Property/Economic Damage, Significant Property/ Economic Damage, Substantial Losses Estimated Upwards of Millions of USD                      |
| Broad Economic Impact                                          | None, Minor, Significant Impact to Local or Regional Interests, Heavy Impact that Affects the National Economy             |
| Fatal Casualties                                          | Number of Fatalities or Casualties   |
| Injuries                                          | Number of Injuries   |
| Protest Concentration                                          | Number of Protests that Day   |

## Chilling EFfect: Data Dictionary

| Variable                                                  | Definition                                                                                                                                                                                                    |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Protest Frequency  (outcome)                                  | Number of Protests in the Year Preceding or Following a Repressive Event                   |
| Region                           | Africa, Americas, Asia, Europe, Middle East        |
| Timing                           | Prior, Post        |
| Actor ID                               | State, International, Non-State, Non-Aligned  |
| Campaign Goals                         | Regime Change, Significant Institutional Reform, Policy Change, Territorial Secession, Greater Autonomy, Unknown                       |
| Tactics                                          | Primarily Non-Violent Event, Mixed Non-Violent and Violent Activity, Primarily Violent Event                           |
| Government Repressive Response                                          | Non-Material and Non-Physical, Material and/or Physical Short of Killing, Material and/or Physical Intended to Result in Death  |
| Year                           | Year of Repressive Event        |

## Ordinal Model: Partial Proportional Odds Assumption

```{r, echo = F, warning = F, message = F}
#https://stats.idre.ucla.edu/r/dae/ordinal-logistic-regression/

# define function to find log odds of being greater than or equal to given response level
sf <- function(y) {
  c('Y>=1' = qlogis(mean(y >= 1)), # y >= 1 gives 0/1 vector and taking mean gives probability of being >= 1
    'Y>=2' = qlogis(mean(y >= 2)), # convert probability of being greater than the response to log odds
    'Y>=3' = qlogis(mean(y >= 3)),
    'Y>=4' = qlogis(mean(y >= 4)),
    'Y>=5' = qlogis(mean(y >= 5)),
    'Y>=6' = qlogis(mean(y >= 6)),
    'Y>=7' = qlogis(mean(y >= 7)))
}

require(Hmisc)
cat_table <- with(df_ord, summary(as.numeric(st_posture) ~  factor(geo_scope, order = F) + actor_id + camp_goals + tactical_choice + region,
                                  fun = sf))
```

```{r echo = F, warning = F, message = F, fig.align='center', fig.height = 16, fig.width = 9}
# this allows us to see the logits relative to the logit for y >= 2
cat_table[,8] <- cat_table[,8] - cat_table[,3]
cat_table[,7] <- cat_table[,7] - cat_table[,3]
cat_table[,6] <- cat_table[,6] - cat_table[,3]
cat_table[,5] <- cat_table[,5] - cat_table[,3]
cat_table[,4] <- cat_table[,4] - cat_table[,3]
cat_table[,3] <- cat_table[,3] - cat_table[,3]

plot(cat_table, which = 1:7, pch = 1:7, xlab = "Difference in Log Odds", 
     main = "Proportional Odds Assumption Satisfied by Data", 
     xlim = range(cat_table[,3:8]))
```

## Negative Binomial Model Diagnostics
```{r}
scatter.smooth(1:length(fitted(m_chill_nb)), rstandard(m_chill_nb, type = 'deviance'), col = 'gray', xlab = "Observation ID", ylab = "Deviance Residuals", main = "Residuals Shows No Clear Patterns")
# plot(m_chill_nb$fitted.values,m_chill_nb$residuals, xlab = "Fitted Values", ylab = "Pearson Residuals", main = "Residual Plot Shows No Pattern in Residuals")
```

